## Key points next q 235

### Autoscaling

- Redshift (data warehousing) cluster is **single AZ**
- Migrate the MySQL database server into a Multi-AZ Amazon RDS for MySQL.
- Enable API caching on API Gateway to reduce the number of Lambda function invocations.
- Use ElasticCache Redis when HA is a must, Memcached **DOES NOT** provide HA
- Use ElasticBeanstalk will give you least amount of efforts to enable autoscaling while keeping no service disruption
- Aurora volume will grow automatically up to **64 TB** by itself without the need from other auto-scaling driver i.e lambda.
- DynamoDB has no max data limit
- Instance Type - (R)am optimised. (M) instance provides a good balance of CPU, RAM, and disk size/performance. (C)ompute optimised. (I) storage optimised.

### Business Continuity

- Spot instance can be interrupted. Reserved Instance provides massive discount and needs at least **1 year** rental term.
- Use DLQ (dead letter queue) for failed transactions reprocess.
- If `RPO` of 1 hour is required, it basically requires backup of data store to be hourly-based.
- CloudFront - Create two cache behaviors for static and dynamic content. Remove the **User-Agent** HTTP header from the whitelist headers section on both of the cache behaviors. Remove the **session cookie** from the whitelist cookies section and the **Authorization HTTP header** from the whitelist headers section for cache behavior configured for static content.
- **EBS is 10 times more expensive than s3**
- Workflow is best to be dealt with AWS SWF
- Month-end reporting -> Need read replica.
- Route53 Health Check needs the endpoint must return an HTTP `2xx` or `3xx` status code and must appear within first `5,120` bytes of the response.
- RDS cross-region snapshot copy could take hours to complete!!!
- There isn't `AWS-RunWindowsPatchBaseline` but is `AWS-RunPatchBaseline`.
- CFN stackset lets you create stacks in AWS accounts across regions by using a single AWS CloudFormation template.
- AWS WorkSpaces used for Windows RDP setup/access
- In general, you should set `Route53 Evaluate Target Health` to Yes for all the alias records in a tree. If you set Evaluate Target Health to No, Route 53 continues to route traffic to the records that an alias record refers to even if health checks for those records are failing.

### Cost Management

- Use lambda@edge when you can - it is a feature of Amazon CloudFront that lets you run code **closer to users of your application, which improves performance and reduces latency**. With Lambda@Edge, you don't have to provision or manage infrastructure in multiple locations around the world. You pay only for the compute time you consume - there is no charge when your code is not running.

With Lambda@Edge, you can enrich your web applications by making them globally distributed and improving their performance â€” all with zero server administration. Lambda@Edge runs your code in response to events generated by the Amazon CloudFront content delivery network (CDN).

- When s3 needs to be accessed by a group of orgs. S3 owner can impose a s3 policy to enable other orgs to have access to it subject to each of them having own aws account. Enable **Requester Pays on the bucket**. Have the orgs use their own aws credentials when accessing the bucket.
- EMR master node **CANNOT** be on a spot instance
- Amazon Athena is an interactive query service that makes it easy to analyze data in Amazon S3 using standard SQL. Athena is serverless, so there is no infrastructure to manage, and you pay only for the queries that you run. It's **CHEAP**. Can be integrated with AWS QuickSight for data visualization.
- Athena can be used to analyze s3 requests through `S3 Access Logs`. i.e identify request source ip.
- Cost explorer, trust advisor, consolidated billing - 3 things to remember when considering cost-saving topics
- Consolidated Billing enables you to see a combined view of AWS costs incurred by all accounts in your department or company, as well as obtain a detailed cost report for each individual AWS account associated with your paying account
- AWS Cost Explorer + AWS Budget to a) get the cause of cost spike b) notify using team
- Use Standard Reserved Instance for applications with steady/predictable usage - no spike/big fall in traffic.

### Migration

- Cert produced by AWS Cert Manager **CANNOT BE** cross-region
- Snowmobile is recommended for transferring data more than **10PB**
- AWS Application Discovery Service helps enterprise customers plan migration projects by gathering information about their on-premises data centers. It has 2 flavours - agent and agentless. When processes information is required, must use agent.
- AWS Database Migration Service does not work with ElasticCache
- Use AWS DMS - Database Migration Service to load and replicate the dataset between on-premise db and replication instance hosted on AWS
- The AWS Schema Conversion Tool (AWS SCT) helps convert your existing database schema from one database engine to another. You can convert from a relational OLTP schema or any supported data warehouse OLAP schema to Amazon RDS (for example, Amazon Aurora MySQL or Amazon Aurora PostgreSQL, among others). This feature can be enabled without having to delete and recreate AWS Org.
- Use AWS SMS (Server Migration Service) Export to help with on-prem VM cloud migration.

### Data Store

- Max EBS IOPS is **64000*.
- S3 IA is suitable for data that is accessed infrequently but still needs an **immediate access**.
- GP2 has **3 IOPS** per GB
- EFS has **higher latency** than EBS provisioned IOPS
- DynamoDB **DOES NOT** support CW events
- DynamoDB should be considered when a lot more reads than writes
- DynamoDB not suitable for structured data
- cross-region replication has 2 copies and hence **double the cost**.
- ElasticCache requires implementation code in application
- S3 provides best durability
- Amazon EMR is a managed cluster platform that simplifies running big data frameworks, such as Apache Hadoop and Apache Spark. Larget dataset processing prefers EMR.
- AWS S3 Glacier has a minimum 90 days of storage. If pull data from that, it will incur pro-rated charge.

### Deployment and operation management

- API Gateway has a payload limit of 10Mb Size Limitation
- Use AWS SAM and built-in AWS **CodeDeploy** to deploy the new Lambda version, gradually shift traffic to the new version, and use pre-traffic and post-traffic test functions to verify code. Rollback if Amazon CloudWatch alarms are triggered.
- `--regions` is NOT a valid param in cfn cli.
- **`Aurora` cluster is multi-az by default**
- lambda can support up to 1000 concurrent calls per second. But limit can be increased.
- Service limit with cloudwatch requires users to be on **Business Plan**
- In dedicated host, `Host Affinity` is set to Host, an instance launched onto a specific host always restarts on the same host if stopped.
- Full stack Health Check on Route53 level can reduce the number of requests a lot as we don't need to check each instance
- Use Data Lifecycle Management service to schedule snapshot creation
- APIG + Lambda - Corresponding error codes on the Method Response in API Gateway, Add integration Responses - regular expression and associate them with HTTP status codes.
- AWS CodeCommit - source control. AWS CodeBuild - build artifacts like app images. AWS CodePipeline - CI/CD Pipeline.
AWS CodeDeploy - Deploy things.

### Networking

- Site-to-Site VPN Conn **DOES NOT** provide high bandwidth. Each AWS Site-to-Site VPN connection has two tunnels and each tunnel supports a maximum throughput of up to **1.25 Gbp**.
- Software VPN with clustering has **ONLY** one conn and hence isn't HA
- max limit **125** peering conns per vpc
- VPN requires internet and does not unfold source ip
- VPC Peering does not block anything
- [VPC Peering - look at One VPC peered with two VPCs](https://docs.aws.amazon.com/vpc/latest/peering/peering-configurations-full-access.html). Routes in route table are static routes.
- Use S3 Transfer Acceleration when uploading large objects and experiencing slow speed.
- IPv6 **NOT SUPPORTED** by NAT Gateway or NAT Instance
- You cannot auto-assign a public IP address if you specify more than one network interface in your instance. Use `EIP` in this case.


### Security

- Use **AWS Org** and add accounts from departments to an O(rg) (U)nit when seeing **autonomy/service isolations**.
- **When choosing multi-account solution, OU is something you need to make sure is present!**
- Cloudtrail to SNS **DOES NOT** have filtering
- **Amazon S3 event notifications typically deliver events in seconds but can sometimes take a minute or longer. On very rare occasions, events might be lost**
- AWS Trusted adviser is NOT event driven, i.e., it must be scheduled. This means running it on some frequency, the quickest refresh is every 5 minutes. It helps with resources provisioning with best practices.
- Use AWS System Manager on all instances to manage patching
- S3 generated keys cannot be managed
- Use tag-based IAM policy to implement granular access control over certain resources. Read Tagging in [cost-management](./cost-management)
- AWS KMS CMK takes key control over from aws account owner
- Kinesis Firehose can encrypt s3 at rest
- **NOT POSSIBLE** to use `sourceip` on s3 bucket policy for VPC endpoint
- Bucket policy can grant permissions to the role **NOT account**
- CloudFront and AWS Shield Advanced is good with DDos protection while WAF will support blocking IPs, SQL injection attacks and Bad Bots.
- SCPs (Service Control Policy) **alone are not sufficient to granting permissions to the accounts in your organization.** No permissions are granted by an SCP. An SCP defines a guardrail, or sets limits, on the actions that the account's administrator can delegate to the IAM users and roles in the affected accounts.
- SCPs are available only in an organization that has **all features enabled**.
- User pool in Cognito is just a directory of users. Use Identity Pool for federated authentication strategy.
- VPCE + S3 policy - a) VPCE policy to only allow operations to perform on the bucket in question. b) S3 Bucket Policy to deny all actions if the source VPCE is not equal to id of VPCE that's created.
- Role switching - Imagine that you have Amazon EC2 instances that are critical to your organization. Instead of directly granting your users permission to terminate the instances, you can create a role with those privileges. Then allow administrators to switch to the role when they need to terminate an instance.
- Use `DNSSEC` to preclude man-in-the-middle attacks. See [this](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-configure-dnssec)
- If CMK material needs to be imported from outside, create a CMK in KMS with no key material which sets the origin to `EXTERNAL`.
- **AWS Config rules + AWS System Manager Automation can automatically remediate S3 bucket policy change**
- For the API Gateway method, set the authorization to AWS_IAM. Then, give the IAM user or role execute-api:Invoke permission on the REST API resource. Enable the API caller to sign requests with AWS Signature when accessing the endpoint. Use AWS X-Ray to trace and analyze user requests to API Gateway.


---

### CloudFront

- 404 error when accessing objects on s3? **Add another origin and behaviour**.

### BeanStalk

- `Swap Env URLs` option for Blue/Green deployment.
- RDS needs to be deployed separately from BeanStalk in **production** environment.

### Lambda

- CPU is allocated linearly in proportion to the amount of memory configured - You cannot control CPU allocation directly.

### AWS Glue

- Glue automatically generates Scala or Python code for your ETL jobs. NOT JAVA!!!
- Scheduled crawling period can be as short as **5 mins**.

### AWS Rekognition

- Use case is detect a known face in a video stream.
- It uses Kinesis Video Streams to receive and process a video stream. **NOT S3**

### VPN vs AWS Direct Connect

- VPC VPN Connection utilizes IPSec to establish encrypted network connectivity between your intranet and Amazon VPC over the **Internet**. VPN Connections can be configured in minutes and are a good solution if you have an immediate need, have low to modest bandwidth requirements, and can tolerate the inherent variability in Internet-based connectivity. AWS Direct Connect does not involve the Internet; instead, it uses dedicated, private network connections between your intranet and Amazon VPC.
- Use **public virtual interface** on a Direct Connect to transfer huge amount of data over the weekend
- When being asked about data movement, choose `Public virtual interface` on a Direct Connect connection.
- Direct Connect taks **3** days to setup - Public Virtual Interface is time consuming as AWS will need to review client's request.
- Public VIF - AWS Direct Connect public VIFs allow you to connect to the `AWS public endpoints with public IP addresses (such as Amazon S3 and Amazon DynamoDB) that are advertised to AWS` over Border Gateway Protocol (BGP).
- Private VIF - Connect you to a VPC via Direct Connect Gateway to any AWS region
![direct-connect](diagrams/direct-connect.png)
- `Have 2 Direct Connect conn from 2 different network carriers` and attach them to the same Virtual Private Gateway will enable a reliable conn between AWS and on-prem
- Use the new Direct Connect Gateway to establish connectivity that spans VPCs spreading across multiple AWS Regions. This option is **cost-effective**.
![direct-connect-gateway](./networking/direct-connect-gateway.png)
- Direct Connect takes priority over configured VPN Conn automatically. So no need to change BGP priority.


### KMS and signed cert

Configure the Auto Scaling group to send an SNS notification of the launch of a new instance to the trusted key management service. Have the Key management service generate a signed certificate and send it directly to the newly launched instance


